<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>T√≠nh ƒêi·ªÉm ∆Øu Ti√™n Deadline</title>
    <style>
        /* CSS N·ªÄN V√Ä KHUNG CHUNG */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Font hi·ªán ƒë·∫°i h∆°n */
            background-color: #f0f4f8; /* M√†u n·ªÅn nh·∫π */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .container { 
            width: 100%;
            max-width: 480px; 
            background: white; 
            padding: 35px; 
            border-radius: 16px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); /* B√≥ng ƒë·ªï s√¢u h∆°n */
            transition: transform 0.3s ease;
        }
        .container:hover {
             /* transform: translateY(-3px); */ /* Hi·ªáu ·ª©ng nh·∫π khi hover */
        }

        /* CSS TI√äU ƒê·ªÄ */
        .header { text-align: center; margin-bottom: 30px; }
        .header h2 { 
            color: #1a202c; 
            margin-bottom: 5px; 
            font-weight: 700; /* ƒê·∫≠m h∆°n */
            font-size: 1.8em;
        }
        .header p { 
            color: #718096; 
            margin-top: 0; 
            font-size: 1em; 
        }

        /* CSS INPUT V√Ä GRID */
        .form-group { margin-bottom: 20px; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .input-full { grid-column: 1 / 3; }
        
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600; 
            color: #2d3748; 
            font-size: 0.95em; 
        }
        input[type="text"], input[type="number"], input[type="datetime-local"] { 
            width: 100%; 
            padding: 14px 12px; 
            border: 1px solid #e2e8f0; 
            border-radius: 8px; 
            box-sizing: border-box; 
            font-size: 1em;
            transition: all 0.3s;
            background-color: #f7fafc; /* M√†u n·ªÅn nh·∫°t cho input */
        }
        input::placeholder { color: #a0aec0; }
        input:focus { border-color: #4299e1; outline: none; box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5); }
        
        /* CSS THANH TR∆Ø·ª¢T (SLIDER) */
        .slider-wrapper {
            background-color: #fff;
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        .slider-container {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        .slider-value { 
            width: 35px; 
            text-align: center; 
            font-weight: bold; 
            color: #4299e1; 
            font-size: 1.2em;
            padding-left: 10px;
        }
        .slider-range {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.85em;
            color: #718096;
            padding: 0 10px;
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 10px;
            background: linear-gradient(to right, #4299e1, #4299e1); /* M√†u cho ph·∫ßn ƒë√£ ch·ªçn */
            background-size: var(--fill-percent, 0%) 100%;
            background-repeat: no-repeat;
            background-color: #e2e8f0; /* M√†u cho ph·∫ßn ch∆∞a ch·ªçn */
            outline: none;
            border-radius: 5px;
            margin: 0;
            padding: 0;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4299e1;
            cursor: grab;
            border: 3px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        /* CSS N√öT SUBMIT */
        button { 
            background-color: #1a202c; 
            color: white; 
            padding: 15px 20px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            margin-top: 30px; 
            width: 100%; 
            font-size: 1.1em;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        button:hover { background-color: #2d3748; }
        
        /* CSS H·ªòP K·∫æT QU·∫¢/L·ªñI */
        #result-box, #error-box { 
            margin-top: 25px; 
            padding: 20px; 
            border-radius: 8px; 
            font-size: 1em;
            font-weight: 500;
        }
        #result-box { border: 2px solid #38a169; background-color: #f0fff4; color: #276749; }
        #error-box { border: 2px solid #e53e3e; background-color: #fff5f5; color: #c53030; }
        .result-detail { margin-top: 10px; font-weight: normal; }

        /* CSS ƒêi·ªÅu h∆∞·ªõng */
        .navigation-link {
            display: block; 
            text-align: center; 
            margin-top: 20px; 
            color: #4299e1; 
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s;
        }
        .navigation-link:hover {
            color: #2b6cb0;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>T√≠nh ƒêi·ªÉm ∆Øu Ti√™n Deadline</h2>
        <p>Nh·∫≠p th√¥ng tin ƒë·ªÉ t√≠nh ƒëi·ªÉm ∆∞u ti√™n v√† l∆∞u v√†o CSDL</p>
        <a href="optimized_schedule.html" class="navigation-link">
            üëâ Xem L·ªãch Tr√¨nh ƒê√£ T·ªëi ∆Øu H√≥a
        </a>
    </div>

    <form id="priorityForm">
        <div class="input-grid">
            <div class="form-group">
                <label for="sinhVienID">Sinh Vi√™n ID</label>
                <input type="text" id="sinhVienID" placeholder="VD: SV001" value="SV001" required>
            </div>

            <div class="form-group">
                <label for="monHocID">M√¥n H·ªçc ID</label>
                <input type="text" id="monHocID" placeholder="VD: M101" value="M101" required>
            </div>
        </div>

        <div class="form-group input-full">
            <label for="tieuDe">Ti√™u ƒê·ªÅ</label>
            <input type="text" id="tieuDe" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ b√†i t·∫≠p" value="B√°o c√°o cu·ªëi k·ª≥ AI" required>
        </div>
        
        <div class="form-group input-full">
            <label>M·ª©c ƒê·ªô Quan Tr·ªçng</label>
            <div class="slider-wrapper">
                <div class="slider-container">
                    <input type="range" id="mucDoQuanTrong" min="1" max="5" step="1" value="3" style="--fill-percent: 50%;">
                    <span id="sliderValue" class="slider-value">3</span>
                </div>
                <div class="slider-range">
                    <span>1</span>
                    <span>2</span>
                    <span>3</span>
                    <span>4</span>
                    <span>5</span>
                </div>
            </div>
        </div>

        <div class="form-group input-full">
            <label for="thoiGianKetThuc">Th·ªùi Gian K·∫øt Th√∫c</label>
            <input type="datetime-local" id="thoiGianKetThuc" required>
        </div>

        <button type="submit">T√≠nh ƒêi·ªÉm ∆Øu Ti√™n & L∆∞u</button>
    </form>

    <div id="result-box" style="display:none;">
        <strong>‚úÖ K·∫øt Qu·∫£ Th√†nh C√¥ng</strong>
        <p class="result-detail">L·ªãch Tr√¨nh ID M·ªõi: <span id="lichTrinhID" style="font-weight: bold;"></span></p>
        <p class="result-detail">ƒêi·ªÉm ∆Øu Ti√™n (P): <span id="diemUuTien" style="font-weight: bold; color: #c53030;"></span></p>
    </div>
    
    <div id="error-box" style="display:none;">
        <strong>‚ùå L·ªói X·∫£y Ra</strong>
        <p class="result-detail">Status: <span id="errorStatus" style="font-weight: bold;"></span></p>
        <p class="result-detail">Chi ti·∫øt l·ªói: <span id="errorMessage"></span></p>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('priorityForm');
        const slider = document.getElementById('mucDoQuanTrong');
        const sliderValue = document.getElementById('sliderValue');
        const resultBox = document.getElementById('result-box');
        const errorBox = document.getElementById('error-box');

        // H√†m c·∫≠p nh·∫≠t thanh tr∆∞·ª£t v√† hi·ªáu ·ª©ng m√†u
        const updateSliderDisplay = (value) => {
            sliderValue.textContent = value;
            const min = parseFloat(slider.min);
            const max = parseFloat(slider.max);
            const percent = ((value - min) / (max - min)) * 100;
            slider.style.setProperty('--fill-percent', `${percent}%`);
        };

        // Kh·ªüi t·∫°o gi√° tr·ªã slider
        updateSliderDisplay(slider.value);

        slider.oninput = function() {
            updateSliderDisplay(this.value);
        };
        
        // C·∫ßn ƒë·∫£m b·∫£o h√†m t√≠nh ph·∫ßn trƒÉm ho·∫°t ƒë·ªông sau khi DOMContentLoaded
        setTimeout(() => {
             updateSliderDisplay(slider.value);
        }, 50);

        // Logic G·ª≠i POST (Kh√¥ng thay ƒë·ªïi so v·ªõi phi√™n b·∫£n tr∆∞·ªõc)
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            resultBox.style.display = 'none';
            errorBox.style.display = 'none';

            const thoiGianInput = document.getElementById('thoiGianKetThuc').value;
            const thoiGianKetThucFormatted = thoiGianInput.replace('T', ' ') + ':00';
            
            const postData = {
                SinhVienID: document.getElementById('sinhVienID').value,
                MonHocID: document.getElementById('monHocID').value,
                TieuDe: document.getElementById('tieuDe').value,
                MucDoQuanTrong: parseInt(slider.value),
                ThoiGianKetThuc: thoiGianKetThucFormatted
            };

            const apiUrl = 'http://127.0.0.1:5000/api/deadline/create';

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json' 
                    },
                    body: JSON.stringify(postData)
                });

                const data = await response.json();

                if (response.ok) {
                    document.getElementById('diemUuTien').textContent = data.DiemUuTien;
                    document.getElementById('lichTrinhID').textContent = data.LichTrinhID_created;
                    resultBox.style.display = 'block';
                } else {
                    document.getElementById('errorStatus').textContent = response.status;
                    document.getElementById('errorMessage').textContent = data.error || data.message;
                    errorBox.style.display = 'block';
                }

            } catch (error) {
                document.getElementById('errorStatus').textContent = 'CONNECTION ERROR';
                document.getElementById('errorMessage').textContent = 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn Server Flask. (Ki·ªÉm tra CORS v√† Terminal Server)';
                errorBox.style.display = 'block';
            }
        });
    });
</script>

</body>
</html>